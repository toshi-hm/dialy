# 要件定義

## 目次
- [1. プロジェクト概要](#1-プロジェクト概要)
- [2. 機能要件](#2-機能要件)
- [3. 非機能要件](#3-非機能要件)
- [4. ユーザーストーリー](#4-ユーザーストーリー)
- [5. 制約事項](#5-制約事項)
- [6. 今後の拡張可能性](#6-今後の拡張可能性)
- [7. 実装完了条件（DoD統合表）](#7-実装完了条件dod統合表)

## 1. プロジェクト概要

### 1.1 背景
日記を書く際、過去の同じ日にどのようなことがあったかを振り返ることで、成長や変化を実感し、より深い内省が可能になる。

### 1.2 目的
過去5年間の同じ日の記録を見ながら、今日の日記を書くことができる直感的な日記アプリケーションを提供する。

### 1.3 ターゲットユーザー
- 継続的に日記を書きたい人
- 過去の記録を振り返りながら自己成長を実感したい人
- シンプルで使いやすいUIを求める人

## 2. 機能要件

### 2.1 必須機能（MVP）

#### FR-01: 日付選択機能
- **優先度**: 高
- **概要**: Dialを回転させて日付を選択できる
- **詳細**:
  - トップページ左上にDial（円形のコントロール）を配置
  - Dialをドラッグして回転させることで日付を変更
  - 選択された日付は中央上部に「◯月◯日（曜日）」の形式で表示
  - デフォルトは今日の日付
  - 過去の日付のみ選択可能（未来の日付は選択不可）

#### FR-02: 日記作成機能
- **優先度**: 高
- **概要**: 選択した日付の日記を作成できる
- **詳細**:
  - 日付表示の下に大きなテキストボックスを配置
  - リアルタイムでの自動保存（入力停止後1秒）
  - 保存状態を視覚的にフィードバック（「保存しました」表示）
  - 明示的な保存ボタンは不要（自動保存のみで完結）
  - テキストフォーマット: プレーンテキスト（MVP版）
  - 文字数制限: 10,000文字

#### FR-03: 日記編集機能
- **優先度**: 高
- **概要**: 過去に作成した日記を編集できる
- **詳細**:
  - 既存の日記がある日付を選択すると、テキストボックスに内容が表示される
  - 編集内容は自動保存される
  - 編集履歴は保持しない（最新版のみ）

#### FR-04: 過去の同じ日の日記表示機能
- **優先度**: 高
- **概要**: 選択した日付の過去5年分の日記をリスト表示
- **詳細**:
  - テキストボックスの下に過去の日記をリスト形式で表示
  - 新しい順（直近の年から）に表示
  - 各日記カードには以下を表示:
    - 年（例: 2025年、2024年）
    - 日記の冒頭テキスト（100文字程度のプレビュー）
    - 文字数
  - クリックで全文を展開表示
  - 日記が存在しない年は表示しない

#### FR-05: 日記削除機能
- **優先度**: 中
- **概要**: 作成した日記を削除できる
- **詳細**:
  - 編集中の日記に「削除」ボタンを配置
  - 削除前に確認ダイアログを表示
  - 削除後は復元不可

### 2.2 将来的な拡張機能

#### FR-06: 検索・フィルタリング機能
- **優先度**: 低
- **概要**: キーワードやタグで日記を検索できる
- **詳細**:
  - 全文検索
  - タグによるフィルタリング
  - 日付範囲での検索

#### FR-07: マークダウン対応
- **優先度**: 低
- **概要**: マークダウン記法で日記を装飾できる
- **詳細**:
  - 見出し、リスト、リンク、画像などのマークダウン記法をサポート
  - プレビュー表示

#### FR-08: 画像添付機能
- **優先度**: 低
- **概要**: 日記に画像を添付できる
- **詳細**:
  - 1日記あたり最大5枚まで
  - ドラッグ&ドロップでのアップロード
  - サムネイル表示

#### FR-09: タグ機能
- **優先度**: 低
- **概要**: 日記にタグを付けて分類できる
- **詳細**:
  - 自由にタグを作成
  - 複数タグの付与
  - タグクラウド表示

#### FR-10: エクスポート機能
- **優先度**: 低
- **概要**: 日記をエクスポートできる
- **詳細**:
  - JSON形式でのエクスポート
  - Markdown形式でのエクスポート
  - PDF形式でのエクスポート

## 3. 非機能要件

### 3.1 パフォーマンス

#### NFR-01: ページ読み込み速度

**MVP版**:
- 初回ページ読み込み: 3秒以内
- Lighthouse Performance Score: 80以上

**将来版（Phase 2）**:
- Lighthouse Performance Score: 90以上（画像最適化、CDN活用など）

#### NFR-02: Dial操作のレスポンス
- **要件**: Dial回転時の日付変更は即座に反映（遅延100ms以内）
- **測定**: フレームレート60fps以上を維持

#### NFR-03: 自動保存
- **要件**: 入力停止後1秒以内に自動保存を実行
- **測定**: デバウンス処理で実装

### 3.2 ユーザビリティ

#### NFR-04: レスポンシブデザイン
- **要件**: モバイル、タブレット、デスクトップで最適な表示
- **対象デバイス**:
  - モバイル: 375px〜767px
  - タブレット: 768px〜1023px
  - デスクトップ: 1024px以上

#### NFR-05: アクセシビリティ
- **要件**: WCAG 2.1 レベルAA準拠
- **詳細**:
  - キーボードのみでの操作可能
  - スクリーンリーダー対応
  - 十分なカラーコントラスト

#### NFR-06: ブラウザ対応
- **対象ブラウザ**:
  - Chrome（最新版および1つ前のバージョン）
  - Firefox（最新版および1つ前のバージョン）
  - Safari（最新版および1つ前のバージョン）
  - Edge（最新版および1つ前のバージョン）

### 3.3 セキュリティ

#### NFR-07: 認証
- **MVP版**: 認証なし（LocalStorageでブラウザローカルに保存）
- **将来版**: NextAuth.js または Auth0を使用
- **移行パス**: LocalStorageからサーバーDBへのマイグレーション機能を提供

#### NFR-08: データ保護
- **要件**: 日記データは暗号化して保存
- **詳細**:
  - HTTPS通信の強制
  - 環境変数による機密情報の管理

#### NFR-09: プライバシー
- **要件**: ユーザーの日記は他のユーザーから閲覧不可
- **詳細**: 適切なアクセス制御の実装

### 3.4 保守性

#### NFR-10: コード品質
- **要件**:
  - TypeScript strict mode有効
  - Biomeによるコード品質チェック
  - テストカバレッジ目標（レイヤーごと）:
    - Domain層: 100%（ビジネスロジックの完全保証）
    - Application層（Use Cases）: 90%以上
    - Presentation層（UI Components）: 60%以上（UIは手動テスト併用）
    - 全体平均: 80%以上

#### NFR-11: ドキュメント
- **要件**:
  - README.mdの整備
  - 設計書の維持
  - Storybookでのコンポーネントドキュメント

### 3.5 可用性

#### NFR-12: オフライン対応（将来）
- **要件**: PWAとしてオフラインでの閲覧・編集が可能
- **優先度**: 低（将来的な実装）

## 4. ユーザーストーリー

### 4.1 日記作成

**As a** 日記を書きたいユーザー
**I want to** 今日の日記を簡単に書ける
**So that** 毎日の記録を継続できる

**受け入れ基準**:
- [ ] トップページにアクセスすると、今日の日付が表示されている
- [ ] 大きなテキストボックスにフォーカスが当たっている
- [ ] 入力すると自動保存される
- [ ] 保存状態（保存中/保存完了/保存失敗）が表示される

### 4.2 過去の振り返り

**As a** 自己成長を実感したいユーザー
**I want to** 過去の同じ日の日記を見ながら今日の日記を書ける
**So that** 1年前、2年前の自分と比較して成長を実感できる

**受け入れ基準**:
- [ ] テキストボックスの下に過去5年分の同じ日の日記が表示される
- [ ] 新しい順（直近から）に並んでいる
- [ ] 各日記の年と冒頭テキストが見える
- [ ] クリックすると全文を読める

### 4.3 日付選択

**As a** 過去の特定の日の日記を見たいユーザー
**I want to** Dialを回して直感的に日付を選択できる
**So that** 簡単に過去の日記にアクセスできる

**受け入れ基準**:
- [ ] Dialをドラッグして回転できる
- [ ] Dial回転に応じて日付が変更される
- [ ] 選択した日付の日記が表示される
- [ ] Dial操作はスムーズで遅延がない

### 4.4 日記編集

**As a** 既存の日記を修正したいユーザー
**I want to** 過去の日記を編集できる
**So that** 間違いを修正したり、追記できる

**受け入れ基準**:
- [ ] 日記がある日付を選択すると、テキストボックスに内容が表示される
- [ ] 編集すると自動保存される
- [ ] 自動保存で更新時刻が更新される

### 4.5 日記削除

**As a** 不要な日記を削除したいユーザー
**I want to** 日記を削除できる
**So that** 不要な記録を整理できる

**受け入れ基準**:
- [ ] 削除ボタンが表示される
- [ ] 削除前に確認ダイアログが表示される
- [ ] 確認後に日記が削除される
- [ ] 削除後はテキストボックスが空になる

## 5. 制約事項

### 5.1 技術的制約
- Next.js 16.1.5およびReact 19.2.4を使用
- pnpmパッケージマネージャーを使用
- Biomeによるコードフォーマット・リント

### 5.2 ビジネス的制約
- MVP版はシングルユーザー向け（認証なし、またはシンプルな認証）
- 画像・動画の添付は将来的な実装
- 外部連携（SNS投稿など）は対象外

### 5.3 データ制約
- 過去5年分の同じ日の日記のみ表示
- 1日記あたりの文字数上限: 10,000文字
- 日記の保存期限: 無制限（削除されるまで永続化）

## 6. 今後の拡張可能性

### 6.1 短期的な拡張（3ヶ月以内）
- タグ機能の追加
- 簡易検索機能
- マークダウン対応

### 6.2 中期的な拡張（6ヶ月以内）
- 画像添付機能
- エクスポート機能
- テーマ・カラーカスタマイズ
- ダークモード対応

### 6.3 長期的な拡張（1年以内）
- PWA化（オフライン対応）
- マルチユーザー対応
- 統計・分析機能（書いた日数、よく使う言葉など）
- リマインダー機能
- AIによる日記の要約・振り返り提案

## 7. 実装完了条件（DoD統合表）

| 要件 | DoD（完了条件） | 検証方法 |
|------|------------------|----------|
| FR-01 日付選択 | Dialのドラッグ操作で日付が変更され、未来日付は選択不可 | UIテスト/E2E、未来日付ガードのユニットテスト |
| FR-02 日記作成 | 選択日付に対して新規作成され、入力停止1秒後に自動保存される | UseCaseテスト、統合テスト |
| FR-03 日記編集 | 既存日記が読み込まれ、編集後に自動保存で更新される | UseCaseテスト、統合テスト |
| FR-04 過去同日表示 | 過去5年の同月同日データが新しい順で表示される | Repository/Domainテスト、UIテスト |
| FR-05 日記削除 | 確認ダイアログ経由で削除し、編集領域がクリアされる | UIテスト/E2E、UseCaseテスト |
| NFR-01/02/03 性能 | 初回表示3秒以内、Dial応答100ms以内、自動保存1秒デバウンス | Lighthouse/計測ログ、性能テスト |
| NFR-04/05/06 UX/A11y | レスポンシブ3ブレークポイント、WCAG 2.1 AA、主要ブラウザ動作 | Storybook a11y、手動検証 |
| NFR-07/08/09 セキュリティ | XSS対策、Zod検証、MVP向けセキュリティヘッダー設定 | コードレビュー、セキュリティチェックリスト |
| NFR-10 品質 | Domain 100% / Application 90% / Presentation 60% のカバレッジ閾値を満たす | `pnpm test:coverage` |
| NFR-11 ドキュメント | README・設計書・Storybookが実装状態と一致 | PRレビュー |
| NFR-12 可用性（将来） | PWA化要件をPhase 3で実装可能な形で保持 | 計画レビュー |

## 付録: 用語集

| 用語 | 定義 |
|------|------|
| Dial | 日付を選択するための円形のUIコントロール。回転させることで日付を変更する。 |
| 同じ日 | 月日が同じで、年が異なる日。例: 2026年2月8日の「同じ日」は、2025年2月8日、2024年2月8日など。 |
| 自動保存 | ユーザー入力停止後、一定時間（MVPでは1秒）で自動的に保存する機能。MVPではLocalStorageに保存する。 |
| 確定保存 | ユーザーが明示操作で保存を確定する方式。MVPでは未採用（将来機能）。 |
| MVP | Minimum Viable Product（最小限の実用可能な製品）。最小限の機能で動作するバージョン。 |
